[toc]

# go 使用 syscall 直接操作共享内存

- https://studygolang.com/articles/10203

## 1: 共享内存的基本知识

- 要使用共享内存要执行以下几步：
  - 发起一个系统调用，让系统帮你生产一块内存，或者取得一块已经存在的内存来使用。
  - 把内存 attach 到当前进程，让当前进程可以使用。大家都知道，我们在进程中访问的是虚拟内存地址，系统会把它映射到物理内存中。如果没有这一步，第 1 步创建的内存就不能在当前进程访问。
  - 这时就可以对内存进程读写操作了。
  - 进程结束的时候要把上面 attach 的内存给释放

## 2: 系统调用的基础知识

- **什么是系统调用?**
- `系统调用（英语：system call）`，又称为系统呼叫，指运行在使用者空间的程序向操作系统内核请求需要更高权限运行的服务。系统调用提供用户程序与操作系统之间的接口

- **系统调用是怎么发起的？以下以 linux 为例**
  - 应用程序以系统调用号和对应的参数传给系统调用 api
  - 系统调用 api 将系统调用号存到 `eax寄存器` 中，然后发起 0x80 的中断号进行中断
  - 内核中的中断处理函数根据系统调用号，调用对应的内核函数（系统调用）
  - 系统调用完成相应功能，将返回值存入 eax，返回到中断处理函数
    中断处理函数返回到 API 中
  - API 将 eax 返回给应用程序

SYS_SHMGET: 创建或者取得共享内存。
SYS_SHMAT: 将共享内存 attach 到当前进程空间。
SYS_SHMDT: 将共享内存从当前进程中 deattach
